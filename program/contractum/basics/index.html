<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <title>RGB smart contracts</title>
  <link rel="stylesheet" href="/tachyons-ext.css">
  <link rel="stylesheet" href="/fonts.css">
  <link rel="stylesheet" href="/front.css">
  <meta http-equiv="cache-control" content="no-cache">
  <meta http-equiv="expires" content="0">
  <meta http-equiv="pragma" content="no-cache">
  
    <meta name="description" content="">

    <meta property="og:title" content="Writing simple contract" />
    <meta property="og:type" content="website" />
    <meta property="og:image" content="https://rgb.tech/rgb-banner.png" />
    <meta name="twitter:card" content="summary_large_image">

    <meta property="og:description" content="">
    <meta property="og:site_name" content="RGB protocol">

    <meta name="twitter:site" content="@lnp_bp">

</head>

<body>
<nav class="flex flex-row justify-center justify-end-l items-center flex-wrap ph2 pl3-ns pr3-ns pb3">
  <div id="logo" class="flex-auto w-100 w-auto-l self-start self-center tc tl-l">
    <a href="/">
      <img alt="RGB Logo" src="/logo/rgb-symbol-color.svg">
    </a>
  </div>
  <ul class="nav list w-100 w-auto-l flex flex-none flex-row flex-wrap justify-center justify-end-l items-center pv2 ph0 ph4-ns">
    <li class="tc pv2 ph2 ph4-ns flex-20-s"><a href="/install">Install</a></li>
    <li class="tc pv2 ph2 ph4-ns flex-20-s"><a href="/learn">Learn</a></li>
    <!-- li class="tc pv2 ph2 ph4-ns flex-20-s">Tools</li -->
    <li class="tc pv2 ph2 ph4-ns flex-20-s"><a href="/governance">Governance</a></li>
    <li class="tc pv2 ph2 ph4-ns flex-20-s"><a href="https://t.me/rgbtelegram">Community</a></li>
    <li class="tc pv2 ph2 ph4-ns flex-20-s"><a href="/blog">Blog</a></li>
  </ul>
</nav>
<main>
  
<section class="section-white">
    <div>
        <header class="pb0">
            <h1>Writing simple contract</h1>
            <div class="highlight"></div>
        </header>

        <p>Let's do a contract which will work as a digital identity.</p>
<p>We have to start with definition of a data type representing the key. This is
not a part of the contract itself and may be imported into multiple contracts
from a <em>data type library</em>.</p>
<pre data-lang="haskell" style="background-color:#2b303b;color:#c0c5ce;" class="language-haskell "><code class="language-haskell" data-lang="haskell"><span style="color:#b48ead;">data </span><span style="color:#d08770;">PgpKey </span><span>:: curve </span><span style="color:#d08770;">U8</span><span>, key </span><span style="color:#d08770;">Bytes
</span></code></pre>
<p>As you might see, the code looks similar to Haskel. New data types are declared
with <code>data</code> keyword, and can be composed of named fields (being structs),
unnamed fields (tuples), operate as enums (in this case you should use
<code>|</code> instead of <code>,</code>), or unions, where each variant may in turn have an
associated structure or tuple. You may read more about constructing data types
in <a href="https://www.strict-types.org/">strict types</a> guidelines.</p>
<p>Now, having the data type we can start definition of our schema:</p>
<pre data-lang="haskell" style="background-color:#2b303b;color:#c0c5ce;" class="language-haskell "><code class="language-haskell" data-lang="haskell"><span>schema </span><span style="color:#d08770;">DecentralizedIdentity
</span><span>   </span><span style="color:#65737e;">-- This defines the atom of the contract state called `Identity`
</span><span>   </span><span style="color:#65737e;">-- which has data type `PgpKey`.
</span><span>   </span><span style="color:#65737e;">-- The `owned` keyword means that there is always a party
</span><span>   </span><span style="color:#65737e;">-- which owns the identity
</span><span>   owned </span><span style="color:#d08770;">Identity </span><span>:: </span><span style="color:#d08770;">PgpKey
</span><span>   </span><span style="color:#65737e;">-- an implicit part of the story is the fact that owned state
</span><span>   </span><span style="color:#65737e;">-- is always assigned to a single-use-seal definition, so the
</span><span>   </span><span style="color:#65737e;">-- proper way of writing the above statement will be
</span><span>   owned </span><span style="color:#d08770;">Identity </span><span>:: </span><span style="color:#d08770;">SingleUseSeal </span><span>-&gt; </span><span style="color:#d08770;">PgpKey
</span><span>   </span><span style="color:#65737e;">-- but we leave the part which repeats for each and every owned
</span><span>   </span><span style="color:#65737e;">-- state to reduce boilerplate of writing `SingleUseSeal -&gt;`
</span><span>   </span><span style="color:#65737e;">-- over and over again.
</span><span>
</span><span>   </span><span style="color:#65737e;">-- This says that to construct contract the user must provide
</span><span>   </span><span style="color:#65737e;">-- information about exactly one identity
</span><span>   </span><span style="color:#8fa1b3;">genesis </span><span style="color:#b48ead;">:: Identity
</span><span>
</span><span>   </span><span style="color:#65737e;">-- Now let&#39;s define what a owner of identity can do,
</span><span>   </span><span style="color:#65737e;">-- He can execute his rights by creating state transitions
</span><span>   </span><span style="color:#65737e;">-- (&quot;operation&quot; on the state) of predefined forms, like
</span><span>   op </span><span style="color:#d08770;">Revocation </span><span>:: old </span><span style="color:#d08770;">Identity </span><span>-&gt; new </span><span style="color:#d08770;">Identity
</span><span>   </span><span style="color:#65737e;">-- which does what it says: it revokes existing identity
</span><span>   </span><span style="color:#65737e;">-- and creates a new one.
</span></code></pre>
<p>As you may see, schema declares state which the contract operates, and
operations, which may update the state.</p>
<p>The state can be global and owned. The difference between these two forms of
state can be illustrated with following statements:</p>
<ul>
<li>
<p><strong>Global state</strong>: <em>nobody owns, everyone knows</em></p>
<p>Examples: asset name</p>
</li>
<li>
<p><strong>Owned state</strong>: <em>someone owns, nobody else knows</em></p>
<p>Examples: asset amounts, voting rights, NFT content</p>
</li>
</ul>
<p>In our example we do not define a global state yet.</p>
<p>There are also three types of operations:</p>
<ul>
<li><strong>Genesis</strong> - a unique operation which takes no input and sets up the contract;</li>
<li><strong>State transition</strong>, which changes some existing owned state ("inputs") and
may add up to the global state;</li>
<li><strong>State extensions</strong>, which may be seen as a "decentralized additional
geneses". State extensions do not have input state, but may produce new owned
state.</li>
</ul>
<p>The schema defines a rules of how the contract operates. Now let's put it into
a practice by creating a specific identity contract, and then doing a revocation:</p>
<pre data-lang="haskell" style="background-color:#2b303b;color:#c0c5ce;" class="language-haskell "><code class="language-haskell" data-lang="haskell"><span>contract meSatoshiNakamoto implements </span><span style="color:#d08770;">DecentralizedIdentity
</span><span>  </span><span style="color:#65737e;">-- this defines a genesis state and assigns it to a single-use-seal
</span><span>  assign orig </span><span style="color:#d08770;">Identity </span><span>:= 
</span><span>    (</span><span style="color:#d08770;">0xfac503c4641c3deda72a2d00bc9d6ff1094b15276c386efea403746a91436772</span><span>, </span><span style="color:#d08770;">1</span><span>)
</span><span>    -&gt; </span><span style="color:#d08770;">PgpKey</span><span>(</span><span style="color:#d08770;">0</span><span>, </span><span style="color:#d08770;">0x028730eeeec41802621d177507b086f390ae600ba3ca5e428b13913af4c2cd25b3</span><span>)
</span><span>
</span><span>transition iLostMyKey executes </span><span style="color:#d08770;">Revocation
</span><span>  </span><span style="color:#65737e;">-- specifies the single-use-seal we close to match requirements
</span><span>  </span><span style="color:#65737e;">-- on the valid operation execution conditions
</span><span>  via meSatoshiNakamoto.orig
</span><span>  
</span><span>  </span><span style="color:#65737e;">-- here we use txid of the bitcoin transaction which will be
</span><span>  </span><span style="color:#65737e;">-- created to hold the commitment to this state transition,
</span><span>  </span><span style="color:#65737e;">-- called &quot;single-use-seal witness&quot;. Since we can not know the
</span><span>  </span><span style="color:#65737e;">-- txid upfront we use ~ to indicate the witness transaction id
</span><span>  assign upd </span><span style="color:#d08770;">Identity </span><span>:= (~, </span><span style="color:#d08770;">2</span><span>) 
</span><span>   -&gt; </span><span style="color:#d08770;">PgpKey</span><span>(</span><span style="color:#d08770;">0</span><span>, </span><span style="color:#d08770;">0x0219db0a4e0eb8cb833608c08d76b9b279ec44a851ab82cc6fd68a9b32624bfa8b</span><span>)
</span><span>   </span><span style="color:#65737e;">-- the above defines new state and assigns it to a single-use-seal
</span></code></pre>

    </div>
</section>

</main>

<footer><div class="w-100 mw-none ph3 mw8-m mw9-l center f3">
  <div class="flex flex-column flex-row-ns pv0-l">
    <div class="flex flex-column mw8 w-100 measure-wide-l pv2 pv5-m pv2-ns ph4-m ph4-l">
      <h4>Get help!</h4>
      <ul>
        <li><a href="http://rgbfaq.com">RGB FAQ</a></li>
        <li><a href="https://blackpaper.rgb.tech">White paper</a></li>
        <li><a href="/docs">Documentation</a></li>
        <li><a href="https://standards.lnp-bp.org">Standards</a></li>
      </ul>
    </div>
    <div class="flex flex-column mw8 w-100 measure-wide-l pv2 pv5-m pv2-ns ph4-m ph4-l">
      <h4>Terms and policies</h4>
      <ul>
        <li><a href="/policies/licenses">Licenses</a></li>
        <li><a href="/policies/logo-policy-and-media-guide/">Logo Policy and Media Guide</a></li>
        <li><a href="/policies/security">Security Disclosures</a></li>
        <li><a href="/policies/privacy-policy/">Privacy Notice</a></li>
      </ul>
    </div>
    <div class="flex flex-column mw8 w-100 measure-wide-l pv2 pv5-m pv2-ns ph4-m ph4-l">
      <h4>Social</h4>
      <div class="flex flex-row flex-wrap">
        <a href="https://twitter.com/lnp_bp"><img src="/social/twitter.svg" alt="twitter logo" title="Twitter"></a>
        <a href="https://www.youtube.com/LNP-BP"><img class="pv2" src="/social/youtube.svg" alt="youtube logo" title="YouTube"></a>
        <a href="https://reddit.com/r/RGB_protocol"><img src="/social/reddit.svg" alt="discord logo" title="Discord"></a>
        <a href="https://github.com/RGB-WG"><img src="/social/github.svg" alt="github logo" title="GitHub"></a>
      </div>
    </div>

  </div>
  <div class="attribution">
    <p>
      Maintained by the <a href="https://www.lnp-bp.org">LNP/BP Standards Association</a>. See a bug?
      <a href="https://github.com/RGB-WG/rgb.tech/issues/new">File an issue!</a>
    </p>
    <p>Uses layout &amp; styles from <a href="https://github.com/rust-lang/www.rust-lang.org" target="_blank">Rust Language website</a></p>
  </div>
</div>

</footer>
</body>

</html>
