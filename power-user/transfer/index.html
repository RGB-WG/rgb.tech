<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <title>RGB smart contracts</title>
  <link rel="stylesheet" href="/tachyons-ext.css">
  <link rel="stylesheet" href="/fonts.css">
  <link rel="stylesheet" href="/front.css">
  <meta http-equiv="cache-control" content="no-cache">
  <meta http-equiv="expires" content="0">
  <meta http-equiv="pragma" content="no-cache">
  
    <meta name="description" content="">

    <meta property="og:title" content="State transfers" />
    <meta property="og:type" content="website" />
    <meta property="og:image" content="https://rgb.tech/rgb-banner.png" />
    <meta name="twitter:card" content="summary_large_image">

    <meta property="og:description" content="">
    <meta property="og:site_name" content="RGB protocol">

    <meta name="twitter:site" content="@lnp_bp">

</head>

<body>
<nav class="flex flex-row justify-center justify-end-l items-center flex-wrap ph2 pl3-ns pr3-ns pb3">
  <div id="logo" class="flex-auto w-100 w-auto-l self-start self-center tc tl-l">
    <a href="/">
      <img alt="RGB Logo" src="/logo/rgb-symbol-color.svg">
    </a>
  </div>
  <ul class="nav list w-100 w-auto-l flex flex-none flex-row flex-wrap justify-center justify-end-l items-center pv2 ph0 ph4-ns">
    <li class="tc pv2 ph2 ph4-ns flex-20-s"><a href="/install">Install</a></li>
    <li class="tc pv2 ph2 ph4-ns flex-20-s"><a href="/learn">Learn</a></li>
    <!-- li class="tc pv2 ph2 ph4-ns flex-20-s">Tools</li -->
    <li class="tc pv2 ph2 ph4-ns flex-20-s"><a href="/governance">Governance</a></li>
    <li class="tc pv2 ph2 ph4-ns flex-20-s"><a href="https://t.me/rgbtelegram">Community</a></li>
    <li class="tc pv2 ph2 ph4-ns flex-20-s"><a href="/blog">Blog</a></li>
  </ul>
</nav>
<main>
  
<section class="section-white">
    <div>
        <header class="pb0">
            <h1>State transfers</h1>
            <div class="highlight"></div>
        </header>

        <p>In most of the cases interaction between contract participants happens through
<strong>invoicing</strong>: if <em>Alice</em> wants <em>Bob</em> to do something with the contract state he
owns (for instance, send some of the tokens to <em>Alice</em>), she constructs an
invoice which contains instructions for Bob on the action he is asked to perform.</p>
<p>Hereinafter we will call Alice, who <strong>issues an invoice</strong>, a <em>beneficiary</em>, and
Bob, who <strong>executes</strong> the invoice, an <em>actor</em>. We say <em>invoice executing</em>
instead of <em>paying the invoice</em>, since invoice may not contain a payment and
carry some other form of action (key revocation, casting a vote etc).</p>
<h3 id="creating-an-invoice">Creating an invoice</h3>
<p>In RGB, invoicing is much more general than just an invoice for a certain amount
of tokens. In fact, you can pack any request for any contract operation, under
any possible schema and interface in form of invoice: revoking identity, voting
in DAO, performing secondary asset issuance, creating NFT engraving and so on,
so on.</p>
<p>To construct an invoice one have to run the following command:</p>
<pre data-lang="sh" style="background-color:#2b303b;color:#c0c5ce;" class="language-sh "><code class="language-sh" data-lang="sh"><span style="color:#bf616a;">$</span><span> rgb invoice $</span><span style="color:#bf616a;">CONTRACT -i </span><span>$</span><span style="color:#bf616a;">INTERFACE -a </span><span>$</span><span style="color:#bf616a;">ACTION </span><span>$</span><span style="color:#bf616a;">STATE </span><span>$</span><span style="color:#bf616a;">SEAL
</span></code></pre>
<p>Here:</p>
<ul>
<li><strong><code>$CONTRACT</code></strong> should be a contract id under which the interaction happens</li>
<li><strong><code>$INTERFACE</code></strong> is human-readable interface name which should be used for
interacting the contract by both parties, beneficiary and actor. It may be
skipped, if the contract schema implements just a single interface.</li>
<li><strong><code>$ACTION</code></strong> is the name of the operation which should be performed by the
actor. If it is skipped, it defaults to an operation which declared in the
used interface as "default".</li>
<li><strong><code>$STATE</code></strong> provides an information about the state, which should be
transferred to the beneficiary single-use-seal defined in the <code>$SEAL</code>
parameter. The state mast match state type for the given action, for instance,
for a transfer of a fungible token it must be an integer specifying amount
of smallest token denominations to be transferred.</li>
<li><strong><code>$SEAL</code></strong> is a definition of a single-use-seal owned by beneficiary; it can
be either a UTXO on beneficiary's wallet, or an address. If an address is used
then the actor will use it to construct an UTXO in his witness transaction,
and this UTXO will be seen and in control of the beneficiary.</li>
</ul>
<p>An example of the command using RGB20 interface to request a token transfer:</p>
<pre data-lang="sh" style="background-color:#2b303b;color:#c0c5ce;" class="language-sh "><code class="language-sh" data-lang="sh"><span style="color:#bf616a;">alice$</span><span> CONTRACT=&#39;</span><span style="color:#a3be8c;">D4RN7r4$-ZNt43c$-ymINZ1r-M$bJPPf-SWp9193-OLIdtv0</span><span>&#39;
</span><span>
</span><span style="color:#bf616a;">alice$</span><span> MY_UTXO=4960acc21c175c551af84114541eace09c14d3a1bb184809f7b80916f57f9ef8:1
</span><span>
</span><span style="color:#bf616a;">alice$</span><span> rgb invoice $</span><span style="color:#bf616a;">CONTRACT -i</span><span> RGB20 100 $</span><span style="color:#bf616a;">MY_UTXO
</span></code></pre>
<p>The result of this commands would be an invoice printed to <code>STDOUT</code>:</p>
<pre style="background-color:#2b303b;color:#c0c5ce;"><code><span>rgb:D4RN7r4$-ZNt43c$-ymINZ1r-M$bJPPf-SWp9193-OLIdtv0
</span><span>/RGB20/BF+bc:utxob:zlVS28Rb-amM5lih-ONXGACC-IUWD0Y$-0JXcnWZ-MQn8VEI-B39!F
</span></code></pre>
<p>To learn more about invoices please refer to <a href="https://rgbfaq.com/glossary/user/invoice">RGB FAQ Website</a></p>
<h3 id="performing-transfer">Performing transfer</h3>
<p>To perform a state transfer <em>Bob</em> has to receive an invoice from <em>Alice</em>.
We assume that <em>Bob</em> has some command-line wallet tool, which is able to
construct, sign and publish normal bitcoin transactions (we will represent
this tool with a <code>wallet</code> command).</p>
<p>At the first stage, Bob constructs PSBT file, which must spend outputs
containing sufficient amount of RGB assets, plus an output to store a change.
We assume that Bob saves PSBT to <code>tx.psbt</code> file.</p>
<p>Now, Bob can pay Alice's invoice (which he saved to <code>$INVOICE</code> variable) with
the following command:</p>
<pre data-lang="sh" style="background-color:#2b303b;color:#c0c5ce;" class="language-sh "><code class="language-sh" data-lang="sh"><span style="color:#bf616a;">bob$</span><span> rgb transfer tx.psbt $</span><span style="color:#bf616a;">INVOICE</span><span> consignment.rgb
</span></code></pre>
<p>The result transfer consignment will be stored to <code>consignment.rgb</code> file in a
binary form. Bob should send this file to Alice by some third-party means - this
can be an e-mail, some file server – or one of existing RGB-related protocols,
like RGB-RPC, Storm (no Lightning network) or something else.</p>
<p>Upon receiving the consignment Alice verifies and accepts it to her local
<strong>RGB stash</strong> (which keeps information about all Alice contracts and owned
state) with the following command:</p>
<pre data-lang="sh" style="background-color:#2b303b;color:#c0c5ce;" class="language-sh "><code class="language-sh" data-lang="sh"><span style="color:#bf616a;">alice$</span><span> rgb accept consignment.rgb
</span></code></pre>
<p>If the consignment was invalid, the command will fail and list all problems the
consignment had. Otherwise, the command should succeed with a single warning –
that the terminal witness transaction is not yet mined. This is due to the fact
that Bob hasn't yet published his transaction yet, since he is waiting on Alice
approval that she is happy with the transfer.</p>
<p>Upon adding transfer consignment to the stash command will return a signature
over the consignment, which Alice can send back to Bob as a form of payslip.</p>
<p>Bob can now check Alice's signature, sign and publish his transaction:</p>
<pre data-lang="sh" style="background-color:#2b303b;color:#c0c5ce;" class="language-sh "><code class="language-sh" data-lang="sh"><span style="color:#bf616a;">bob$</span><span> rgb check &lt;sig&gt; &amp;&amp; </span><span style="color:#bf616a;">wallet</span><span> sign</span><span style="color:#bf616a;"> --publish</span><span> tx.psbt
</span></code></pre>
<p>Alice's RGB wallet will see the witness transaction mined, after which the
new state will appear in her user interface.</p>

    </div>
</section>

</main>

<footer><div class="w-100 mw-none ph3 mw8-m mw9-l center f3">
  <div class="flex flex-column flex-row-ns pv0-l">
    <div class="flex flex-column mw8 w-100 measure-wide-l pv2 pv5-m pv2-ns ph4-m ph4-l">
      <h4>Get help!</h4>
      <ul>
        <li><a href="http://rgbfaq.com">RGB FAQ</a></li>
        <li><a href="https://blackpaper.rgb.tech">White paper</a></li>
        <li><a href="/docs">Documentation</a></li>
        <li><a href="https://standards.lnp-bp.org">Standards</a></li>
      </ul>
    </div>
    <div class="flex flex-column mw8 w-100 measure-wide-l pv2 pv5-m pv2-ns ph4-m ph4-l">
      <h4>Terms and policies</h4>
      <ul>
        <li><a href="/policies/licenses">Licenses</a></li>
        <li><a href="/policies/logo-policy-and-media-guide/">Logo Policy and Media Guide</a></li>
        <li><a href="/policies/security">Security Disclosures</a></li>
        <li><a href="/policies/privacy-policy/">Privacy Notice</a></li>
      </ul>
    </div>
    <div class="flex flex-column mw8 w-100 measure-wide-l pv2 pv5-m pv2-ns ph4-m ph4-l">
      <h4>Social</h4>
      <div class="flex flex-row flex-wrap">
        <a href="https://twitter.com/lnp_bp"><img src="/social/twitter.svg" alt="twitter logo" title="Twitter"></a>
        <a href="https://www.youtube.com/LNP-BP"><img class="pv2" src="/social/youtube.svg" alt="youtube logo" title="YouTube"></a>
        <a href="https://reddit.com/r/RGB_protocol"><img src="/social/reddit.svg" alt="discord logo" title="Discord"></a>
        <a href="https://github.com/RGB-WG"><img src="/social/github.svg" alt="github logo" title="GitHub"></a>
      </div>
    </div>

  </div>
  <div class="attribution">
    <p>
      Maintained by the <a href="https://www.lnp-bp.org">LNP/BP Standards Association</a>. See a bug?
      <a href="https://github.com/RGB-WG/rgb.tech/issues/new">File an issue!</a>
    </p>
    <p>Uses layout &amp; styles from <a href="https://github.com/rust-lang/www.rust-lang.org" target="_blank">Rust Language website</a></p>
  </div>
</div>

</footer>
</body>

</html>
